<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" /> -->
    <!-- <link rel="stylesheet" type="text/css" href='css/pace.css' /> -->
    <link rel="stylesheet" type="text/css" href='css/ServiceGuide.css' />
    <link rel="stylesheet" type="text/css" href="css/animations.css" />
    <link rel="stylesheet" href="css/winbox.min.css">
    <script type="text/javascript" src='js/jquery-3.4.1.min.js'></script>
    <script type="text/javascript" src='js/darktooltip.js'></script>
    <!-- <script type="text/javascript" src='js/pace.js'></script> -->
    <script type="text/javascript" src='js/ServiceGuide.js'></script>
    <script src="js/modernizr.custom.js"></script>
    <script src="js/winbox.min.js"></script>


    <style>
        html,
        body {
            position: relative;
            height: 100%;
            overflow: hidden;
        }

        body {
            background: #eee;
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .pt-main {
            left: 0px;
            top: 0px;
            margin: 0px;
            padding: 0px;
            width: 100%;
            /* /* height: 100%; */
        }

        .pt-perspective {
            position: relative;
            width: 100%;
            height: 100%;
            -webkit-perspective: 1200px;
            -moz-perspective: 1200px;
            perspective: 1200px;
        }

        .pt-page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            visibility: hidden;
            overflow: hidden;
            -webkit-backface-visibility: hidden;
            -moz-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
            -webkit-transform-style: preserve-3d;
            -moz-transform-style: preserve-3d;
            transform-style: preserve-3d;
        }

        .pt-page-current,
        .no-js .pt-page {
            visibility: visible;
            z-index: 1;
        }

        .app-page {
            display: block;
            left: 0px;
            top: 0px;
            margin: 0px;
            padding: 0px;
            width: 100%;
            height: 100%;
            border: none;
        }


        .winbox {
            background: #ECECEC;
            border-radius: 4px 4px 0 0;
            border: 1px solid #a7a7a7;
            /* -webkit-transition: box-shadow 0.5s; */
        }

        .wb-title {
            font-family: Roboto;
            font-weight: bold;
            color: #7f7f7f;
            text-decoration: none;
            text-shadow: 0px 1px 0px #fff;
        }

        .wb-body {
            border: 1px solid #a7a7a7;
        }

        .wb-control * {
            -webkit-filter: invert(50%);
        }

        .wb-history {
            background-size: 20px auto;
        }


        .overlay {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #ECECEC;
            opacity: 0.95;
            overflow-x: hidden;
        }

        .overlay-content {
            position: relative;
            top: 4px;
            width: 100%;
        }

        /* .overlay a {
            padding: 8px;
            text-decoration: none;
            font-size: 16px;
            color: #818181;
            display: block;
        } */

        .overlay .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 26px;
        }

        .vertical-menu a {
            display: block;
            background-color: #eee;
            text-align: start;
            font-family: Roboto;
            font-weight: bold;
            color: #7f7f7f;
            text-decoration: none;
            text-shadow: 0px 1px 0px #fff;
            padding: 12px;
            margin: 2%;
        }

        .mediaitem:hover {
            border: 1px solid #a7a7a7;
        }

        .mediaitem img {
            left: 4px;
            transform: translateY(6px);
            margin-right: 8px;
            -webkit-filter: invert(50%);
        }

        .active img {
            text-shadow: 0px 1px 0px #fff;
            -webkit-filter: invert(50%);
            transform: translateY(18px);
        }

        .active {
            background-color: transparent;
        }

        .active a {
            font-size: 36px;
        }
        
    </style>

    <script>

        var mediabox = 0;
        var oldpage = 0;
        var usehitory = false;
        var currentpage = 1;
        var visitedpage = [0];
        var curvisited = -1;
        var medialist = [];


        var ANIM_PRESENTATION = 40;
        var ANIM_EDIAG_EPARTS = 4;
        // var ANIM_OTHER = 1;//67;//54;//36;//51;//36;//16;    
        var ANIM_OTHER = 68;//67;//54;//36;//51;//36;//16;  
        var ANIM_LAST = 1;//67;//54;//36;//51;//36;//16;  
        var ANIM_NEXT = 2;//67;//54;//36;//51;//36;//16;

        function ShowMedia(content) {
            if (mediabox) {
                mediabox.close();
            }
            mediabox = new WinBox("ServiceGuide", {
                border: "0.3em",
                x: "58%",
                y: "56%",
                width: "40%",
                height: "40%",
                hidden: false,
                onclose: function (force) {
                    mediabox = 0;
                }
            });

            const imgvid = "<img src='media/media_movie.png'/>";
            const imgpdf = "<img src='media/media_pdf.png'/>";
            const imgurl = "<img src='media/media_url.png'/>";
            const imgoth = "<img src='media/media_other.png'/>";
            mediabox.mount($('#mediacontent')[0]);
            $('#mediaframe').attr('src', content);
            $('#mediacontent').show();
            if (medialist.length) {
                $('.mediaitem').remove();}
            if (!medialist.includes(content)) {
                medialist.push(content);}
            for (var i = 0; i < medialist.length; i++) {
                var icon = imgoth;
                var file = medialist[i];
                var ext = file.split('.').pop();
                if (ext === "mp4") { icon = imgvid; }
                if (ext === "pdf") { icon = imgpdf; }
                $(".vertical-menu").append(
                    '<a href="#" class="mediaitem">' + icon + file + '</a>');
            }
            $(".mediaitem").click(function(){
                $('#mediaframe').attr('src', $(this).text());
                closeNav();
            });

            mediabox.addControl({
                index: 0,
                class: "wb-history",
                image: "media/history.svg",
                click: function (event, winbox) {
                    console.log(winbox.id);
                    openNav();
                }
            });
        }

        function openNav() {
            document.getElementById("myNav").style.width = "100%";
        }

        function closeNav() {
            document.getElementById("myNav").style.width = "0%";
        }

        function AddPageHistory(page) {
            console.log(visitedpage);
            if (usehitory) {
                usehitory = false;
                return;
            }
            visitedpage = visitedpage.slice(0, curvisited + 1);
            if (page == visitedpage[visitedpage.length - 1]) { return; }
            visitedpage.push(page);
            curvisited = visitedpage.length - 1;
        }

        function ButtonLastPage() {
            if (visitedpage.length == 0) { return; }
            if (curvisited < 0) { curvisited = 0; return; }
            var pagenum = visitedpage[curvisited];
            var cpage = currentpage;
            if ((pagenum == cpage) && (curvisited >= 1)) {
                curvisited = curvisited - 1;
                pagenum = visitedpage[curvisited];
            }
            usehitory = true;
            console.log(pagenum);
            currentpage = pagenum;
            PageTransitions.setPage(pagenum, ANIM_LAST);
        }

        function ButtonNextPage() {
            var size = visitedpage.length;
            if (size == 0) { return; }
            if (curvisited >= size) { curvisited = size - 1; return; }
            var pagenum = visitedpage[curvisited];
            var cpage = currentpage;
            if ((pagenum == cpage) && (curvisited <= size - 2)) {
                curvisited = curvisited + 1;
                pagenum = visitedpage[curvisited];
            }
            usehitory = true;
            currentpage = pagenum;
            PageTransitions.setPage(pagenum, ANIM_NEXT);
        }


        function GoToPage(n, animation) {
            if (n !== oldpage) {
                currentpage = n;
                PageTransitions.setPage(currentpage, animation);
                AddPageHistory(currentpage);
                oldpage = currentpage;
            }
            else { ReloadPage(n); }
        }

        function ReloadPage(n) {
            var id = 'pg' + (n + 1).toString();
            // document.getElementById(id).contentWindow.location.reload();
            document.getElementById(id).src = document.getElementById(id).src
        }

        window.onmessage = function (event) {

            if (event.data == '_fullscreen_') {
                FullScreen();
            }

            if (event.data == 'media_src') {
                if (sessionStorage.length) {
                    let src = sessionStorage.getItem('_media_src_');
                    ShowMedia(src);
                }
            }

            if (event.data == "_prev_page_history_") {
                // ButtonLastPage();
            }
            if (event.data == "_next_page_history_") {
                // ButtonNextPage();
            }
            if (event.data == 'mframe_goto_Presentation.html') {
                GoToPage(0, ANIM_PRESENTATION);
            }
            if (event.data == 'mframe_goto_Documentation.html') {
                SendCustomEventToIframe("pg2", "shown");
                GoToPage(1, ANIM_OTHER);
            }
            if (event.data == 'mframe_goto_SearchText.html') {
                GoToPage(2, ANIM_OTHER);
            }
            if (event.data == 'mframe_goto_ErrorCode.html') {
                GoToPage(3, ANIM_OTHER);
            }
            var start = 4;
            for (var i = 0; i < productnames.length; i++) {
                if (event.data == 'mframe_goto_ElectricalDiagram_' + productnames[i] + '.html') {
                    GoToPage(start + i, ANIM_OTHER);
                }
            }
            start = 4 + productnames.length;
            for (var i = 0; i < productnames.length; i++) {
                if (event.data == 'mframe_goto_eParts_' + productnames[i] + '.html') {
                    GoToPage(start + i, ANIM_OTHER);
                }
            }
        };

        $(document).ready(function () {

            function AddPages(item, n) {
                for (var i = 0; i < productnames.length; i++) {
                    var id = "pg" + n.toString();
                    var cls = "pt-page pt-page-" + n.toString();
                    var src = item + "_" + productnames[i] + ".html"
                    var page = "<div class='" + cls + "'><iframe class='app-page' id='" + id + "' src='" + src + "'></iframe ></div>";
                    $("#pt-main").append(page);
                    n++;
                }
            }
            var start = 5;
            AddPages("ElectricalDiagram", start);
            start = start + productnames.length;
            AddPages("eParts", start);
            PageTransitions.init();
            AddPageHistory(0);

            $('iframe').on('load', function () {
                var src = $(this).attr('src');
                console.log(src, 'loaded!');
            });
        })

    </script>

</head>

<body>


    <div id="pt-main" class="pt-perspective">
        <div class="pt-page pt-page-1"><iframe class="app-page" id="pg1" src="Presentation.html"></iframe></div>
        <div class="pt-page pt-page-2"><iframe class="app-page" id="pg2" src="Documentation.html"></iframe></div>
        <div class="pt-page pt-page-3"><iframe class="app-page" id="pg3" src="SearchText.html"></iframe></div>
        <div class="pt-page pt-page-4"><iframe class="app-page" id="pg4" src="ErrorCode.html"></iframe></div>
    </div>


    <div id="mediacontent" style="display:none;">
        <div id="myNav" class="overlay">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <div class="overlay-content">
                <div class="vertical-menu">
                    <a href="#" class="active"><img src='media/big_history.png'/>Media files</a>
                </div>
            </div>
        </div>
        <iframe id="mediaframe"></iframe>
    </div>

</body>

<script src="js/pagetransitions.js"></script>
<script>
    //http://localhost:5000/?SearchText
    console.log(window.location.search);
    var search = window.location.search;
    if (search === "?Documentation") {
        GoToPage(1, ANIM_OTHER);
    }
    if (search === "?SearchText") {
        GoToPage(2, ANIM_OTHER);
    }
    if (search === "?ErrorCode") {
        GoToPage(3, ANIM_OTHER);
    }
</script>

</html>